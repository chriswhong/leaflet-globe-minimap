!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("d3"),require("leaflet"),require("topojson-client"));else if("function"==typeof define&&define.amd)define(["d3","leaflet","topojson-client"],e);else{var o="object"==typeof exports?e(require("d3"),require("leaflet"),require("topojson-client")):e(t.d3,t.L,t.topojson);for(var n in o)("object"==typeof exports?exports:t)[n]=o[n]}}(this,function(t,e,o){return function(t){function e(n){if(o[n])return o[n].exports;var i=o[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var o={};return e.m=t,e.c=o,e.i=function(t){return t},e.d=function(t,o,n){e.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=3)}([function(e,o){e.exports=t},function(t,o){t.exports=e},function(t,e){t.exports=o},function(t,e,o){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}();o(0);var l=o(1),s=function(t){return t&&t.__esModule?t:{default:t}}(l);o(2);var p=function(t){function e(){return n(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return r(e,t),a(e,[{key:"initialize",value:function(t){s.default.Util.setOptions(this,t),console.log(this.options)}},{key:"onAdd",value:function(t){return console.log("onAdd()"),this._mainMap=t,this._container=s.default.DomUtil.create("div","leaflet-control-minimap"),this._container.style.width=this.options.width+"px",this._container.style.height=this.options.height+"px",s.default.DomEvent.disableClickPropagation(this._container),s.default.DomEvent.on(this._container,"mousewheel",s.default.DomEvent.stopPropagation),this._userToggledDisplay=!1,this._minimized=!1,this._mainMap.on("moveend",this._onMainMapMoved,this),this._container}},{key:"addTo",value:function(t){return console.log("addTo()"),s.default.Control.prototype.addTo.call(this,t),this.initCanvas(),this}},{key:"initCanvas",value:function(){d3.select(".leaflet-control-minimap").append("svg").attr("width",82).attr("height",82).attr("style","position: absolute; left: 0; top: 0;").append("path").attr("d","m 768,896 q 0,106 -75,181 -75,75 -181,75 -106,0 -181,-75 -75,-75 -75,-181 0,-106 75,-181 75,-75 181,-75 106,0 181,75 75,75 75,181 z m 256,0 q 0,-109 -33,-179 L 627,-57 q -16,-33 -47.5,-52 -31.5,-19 -67.5,-19 -36,0 -67.5,19 Q 413,-90 398,-57 L 33,717 Q 0,787 0,896 q 0,212 150,362 150,150 362,150 212,0 362,-150 150,-150 150,-362 z").attr("transform","scale(.01,-.01),translate(3600,-3900)").attr("style","fill:"+this.options.marker),this.projection=d3.geo.orthographic().scale(40).translate([41,41]).rotate([0,0]).clipAngle(90);var t=d3.select(".leaflet-control-minimap").append("canvas").attr("width",400).attr("height",400);this.c=t.node().getContext("2d"),this.path=d3.geo.path().projection(this.projection).context(this.c);var e=this;d3.json(this.options.topojsonSrc,function(t){e.globe={type:"Sphere"},e.land=topojson.feature(t,t.objects.land)}),this.transitionMap(this._mainMap.getCenter())}},{key:"transitionMap",value:function(t){console.log("transtionMap");var e=this,o=e.c,n=e.path;d3.transition().duration(1250).each("start",function(){}).tween("rotate",function(){var i=d3.interpolate(e.projection.rotate(),[-t.lng,-t.lat]);return function(t){e.projection.rotate(i(t)),o.clearRect(0,0,e.options.width,e.options.height),o.fillStyle=e.options.water,o.beginPath(),n(e.globe),o.fill(),o.fillStyle=e.options.land,o.beginPath(),n(e.land),o.fill()}})}},{key:"onRemove",value:function(t){this._mainMap.off("moveend",this._onMainMapMoved,this),this._mainMap.off("move",this._onMainMapMoving,this)}},{key:"_onMainMapMoved",value:function(t){console.log("mainmapmoved"),this._miniMapMoving?this._miniMapMoving=!1:(this._mainMapMoving=!0,this.transitionMap(this._mainMap.getCenter()))}}]),e}(s.default.Control);p.prototype.options={position:"bottomright",width:82,height:82,land:"#bbb",water:"rgba(0, 0, 0, 0.3)",marker:"#CC0000",topojsonSrc:"data/world.json"},s.default.Control.GlobeMiniMap=p,e.default=p,s.default.control.globeminimap=function(t,e){return new s.default.Control.GlobeMiniMap(t,e)},s.default.Map.mergeOptions({miniMapControl:!1}),s.default.Map.addInitHook(function(){this.options.miniMapControl&&(this.miniMapControl=(new GlobeMiniMap).addTo(this))})}])});